# test pipeline for integrated cache support

name: $(Date:yyy.MM.dd)$(Rev:.r)

trigger: none
pr: none

resources:
- repo: self

pool:
  vmImage: ubuntu-latest

variables:
  CCACHE_DIR: $(Pipeline.Workspace)/ccache

jobs:
- job: Check
  steps:
  - bash: |
      sudo apt-get install ccache -y    
      echo "##vso[task.prependpath]/usr/lib/ccache"
    displayName: Install ccache and update PATH to use linked versions of gcc, cc, etc
  - script: |
      echo "Test pipeline OK"
      which ccache
      mkdir $$(Pipeline.Workspace)/ccache && echo 'ok' > $$(Pipeline.Workspace)/ccache/test.f
  - task: Cache@2
    inputs:
      key: 'ccache | "$(Agent.OS)"'
      path: $(CCACHE_DIR)
      restoreKeys: | 
        ccache | "$(Agent.OS)"
    displayName: ccache
